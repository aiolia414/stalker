#!/usr/bin/env python
import sys
import getpass
import optparse
import stalkerweb

def main():
    usage = '''%prog --host 0.0.0.0 -p 5000 --debug -a <username>'''
    args = optparse.OptionParser(usage)
    args.add_option('--host', default='0.0.0.0',
                    help='default = all ips')
    args.add_option('--port', '-p', default='5000',
                    help='default = 5000', type="int")
    args.add_option('--debug', '-d', action="store_true",
                    help="default = False")
    args.add_option('--add-user', '-a', help="Add a user")
    options, arguments = args.parse_args()

    if options.add_user:
        with stalkerweb.app.test_request_context():
            username = options.add_user
            password = getpass.getpass('Enter password for %s: ' % username).strip()
            email = raw_input('Enter email: ').strip()
            stalkerweb.auth.add_user(username, password, email)
        sys.exit()
    else:
        stalkerweb.app.run(host=options.host, port=options.port,
                debug=options.debug)

if __name__ == '__main__':
    main()
