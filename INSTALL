# Ubuntu install (via stdeb built packages)

## stalker-manager|runner|web

Mongo setup:

    sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
    sudo su -c 'echo "deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen" >>  /etc/apt/sources.list.d/10gen.list'
    sudo apt-get update
    sudo apt-get install mongodb-10gen
    sudo su -c 'echo "bind_ip = 127.0.0.1" >> /etc/mongodb.conf'
    sudo service mongodb restart

### stalker-web 

Setup stalker-web (stdeb built) and dependencies (you may wanna build in virtualenv):

    sudo apt-get install redis-server gcc python-dev
    git clone https://github.com/pandemicsyn/stalker.git
    cd stalker
    python setup.py --command-packages=stdeb.command bdist_deb
    dpkg -i deb_dist/python-stalker_0.X.X-1_all.deb
    #alternatively setup stalker via setup.py
    #python setup.py install
    sudo pip install flask flask-wtf==0.8 flask-bcrypt flask-pymongo redis
    stalker-web --gen-config > etc/stalkerweb-simple.cfg
    stalker-web --conf=etc/stalkerweb-simple.cfg --init-db
    stalker-web -a <yourusername>
    #start service in debug mode
    stalker-web --conf=etc/stalkerweb-simple.cfg -d
    #alternatively start stalkerweb using gunicorn in daemon mode (w/ 2 workers)
    #stalker-web --conf=etc/stalkerweb-simple.cfg -w 2 -G

### stalker-manager
 
Assumes you built and installed packages above

    #start stalker-manager in the foreground
    mdkir /var/run/stalker; chown <youruser>:<youruser> /var/run/stalker
    stalker-manager --pid=/var/run/stalker/manager.pid --conf=etc/stalker-manager.conf start

### stalker-runner

Assumes you built and installed packages above

    #start stalker-runner in the foreground
    mdkir /var/run/stalker; chown <youruser>:<youruser> /var/run/stalker
    stalker-runner --pid=/var/run/stalker/runner.pid --conf=etc/stalker-runner.conf start

### stalker-agent

    dpkg -i python-stalker
    apt-get install python-eventlet nagios-plugins-extra
    update-rc.d -f stalker-agent defaults
    update-rc.d -f stalker-agent enable
    sudo service stalker-agent start

###Logs

Check /var/log/stalker/* for info, you can also start the daemons with -f (in the foreground)
Make sure you deploy an SSL Cert and Key for stalker-agent.
For stalker-web you'll probably want to front it by nginx w/ SSL.
